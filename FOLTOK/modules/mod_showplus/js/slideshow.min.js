(function(){WhenPaused=1;WhenPlaying=2;OnStart=4;Slideshow=new Class({Implements:[Chain,Events,Options],options:{accesskeys:{first:{key:"shift left",label:"Shift + Left"},prev:{key:"left",label:"Left"},pause:{key:"p",label:"P"},next:{key:"right",label:"Right"},last:{key:"shift right",label:"Shift + Right"}},captions:!1,center:!0,classes:[],controller:!1,data:null,delay:2E3,duration:750,fast:!1,height:!1,href:"",hu:"",linked:!1,loader:!0,loop:!0,match:/\?slide=(\d+)$/,cover:!0,overlap:!0,overlay:!1,
paused:!1,random:!1,replace:[/(\.[^\.]+)$/,"t$1"],resize:!1,slide:0,thumbnails:!1,thumbsize:[],titles:!0,transition:"sine:in:out",width:!1},initialize:function(a,b,c){this.setOptions(c);if(this.el=document.id(a)){a=window.location.href.match(this.options.match);this.slide=this._slide=this.options.match&&a?a[1].toInt():this.options.slide;this.counter=this.timeToNextTransition=this.timeToTransitionComplete=0;this.direction="left";this.cache={};this.paused=!1;this.options.overlap||(this.options.duration*=
2);var d=this.el.getElement("a")||new Element("a");this.options.href||(this.options.href=d.get("href")||"");this.options.hu.length&&!this.options.hu.test(/\/$/)&&(this.options.hu+="/");!0===this.options.fast&&(this.options.fast=WhenPaused|WhenPlaying);a="slideshow first prev play pause next last images captions controller thumbnails hidden visible inactive active loader overlay".split(" ");this.classes=a.map(function(a,b){return this.options.classes[b]||a},this).associate(a);this.classes.get=function(){for(var a=
"."+this.slideshow,b=0,c=arguments.length;b<c;b++)a+="-"+this[arguments[b]];return a}.bind(this.classes);if(!b){this.options.hu="";b={};var f=this.el.getElements(this.classes.get("thumbnails")+" img");this.el.getElements(this.classes.get("images")+" img").each(function(a,c){var d=a.src,e=a.alt||a.title,g=a.getParent().href;b[d]={caption:e,href:g,thumbnail:f[c]?f[c].src:""}})}if(this.load(b)){this.events={};this.events.push=function(a,b){this[a]||(this[a]=[]);this[a].push(b);document.addEvent(a,b);
return this}.bind(this.events);this.accesskeys={};for(action in this.options.accesskeys){var g=this.options.accesskeys[action];this.accesskeys[action]=accesskey={label:g.label};["shift","control","alt"].each(function(a){var b=RegExp(a,"i");accesskey[a]=g.key.test(b);g.key=g.key.replace(b,"")});accesskey.key=g.key.trim()}this.events.push("keyup",function(a){Object.each(this.accesskeys,function(b,c){if(a.key==b.key&&a.shift==b.shift&&a.control==b.control&&a.alt==b.alt)this[c]()},this)}.bind(this));
a=this.el.getElement(this.classes.get("images"));c=this.el.getElement("img")||new Element("img");var e=a?a.empty():(new Element("div",{"class":this.classes.get("images").substr(1)})).inject(this.el);a=e.measure(function(){return this.getSize()});this.height=this.options.height||a.y;this.width=this.options.width||a.x;e.set({styles:{height:this.height,width:this.width}});this.el.store("images",e);this.options.cover?(this.a=this.image=new Element("span"),c.setStyle("display","none")):this.a=this.image=
c;Browser.ie&&7<=Browser.version&&(this.a.style.msInterpolationMode="bicubic");this.a.set("styles",{display:"none"});this.b=this.a.clone();[this.a,this.b].each(function(a){d.clone().cloneEvents(d).grab(a).inject(e)});this.options.captions&&new p(this);this.options.controller&&new q(this);this.options.loader&&new r(this);this.options.thumbnails&&new s(this);!1!==this.options.overlay&&(a=(new Element("div",{"class":this.classes.get("overlay").substr(1)})).inject(e),!0===this.options.overlay||a.set("html",
this.options.overlay));this._preload(this.options.fast&OnStart)}}},go:function(a,b){a==(this.slide+this.data.images.length)%this.data.images.length||Date.now()<this.timeToTransitionComplete||(clearTimeout(this.timer),this.timeToNextTransition=0,this.direction=b?b:a<this._slide?"right":"left",this.slide=this._slide=a,this.preloader&&(this.preloader=this.preloader.destroy()),this._preload(this.options.fast&WhenPlaying||this.paused&&this.options.fast&WhenPaused))},first:function(){this.prev(!0)},prev:function(a){var b=
0;if(!a)if(this.options.random){if(2>this.showed.i)return;this.showed.i-=2;b=this.showed.array[this.showed.i]}else b=(this.slide-1+this.data.images.length)%this.data.images.length;this.go(b,"right")},pause:function(a){void 0!=a&&(this.paused=a?!1:!0);this.paused?(this.paused=!1,this.timeToTransitionComplete=Date.now()+this.timeToTransitionComplete,this.timer=this._preload.delay(50,this),[this.a,this.b].each(function(a){["morph","tween"].each(function(a){this.retrieve(a)&&this.get(a).resume()},a)}),
this.controller&&this.el.retrieve("pause").getParent().removeClass(this.classes.play)):(this.paused=!0,this.timeToTransitionComplete-=Date.now(),clearTimeout(this.timer),[this.a,this.b].each(function(a){["morph","tween"].each(function(a){this.retrieve(a)&&this.get(a).pause()},a)}),this.controller&&this.el.retrieve("pause").getParent().addClass(this.classes.play))},next:function(a){this.go(a?this.data.images.length-1:this._slide,"left")},last:function(){this.next(!0)},load:function(a){this.firstrun=
!0;this.showed={array:[],i:0};"array"==typeOf(a)&&(this.options.captions=!1,a=Array(a.length).associate(a.map(function(a,b){return a+"?"+b})));this.data={images:[],captions:[],hrefs:[],thumbnails:[],thumbsizes:[],targets:[],titles:[]};for(var b in a){var c=a[b]||{};b=this.options.hu+b;var d=c.caption?c.caption.trim():"",f=c.href?c.href.trim():this.options.linked?b:this.options.href,g=c.target?c.target.trim():"_self",e=c.thumbnail?this.options.hu+c.thumbnail.trim():b.replace(this.options.replace[0],
this.options.replace[1]),c=c.thumbsize?c.thumbsize:this.options.thumbsize,h=d.replace(/<.+?>/gm,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"'");this.data.images.push(b);this.data.captions.push(d);this.data.hrefs.push(f);this.data.targets.push(g);this.data.thumbnails.push(e);this.data.thumbsizes.push(c);this.data.titles.push(h)}this.options.random&&(this.slide=this._slide=Number.random(0,this.data.images.length-1));this.options.thumbnails&&this.el.retrieve("thumbnails")&&this._thumbnails();
this.el.retrieve("images")&&([this.a,this.b].each(function(a){["morph","tween"].each(function(a){this.retrieve(a)&&this.get(a).cancel()},a)}),this.slide=this._slide=this.timeToTransitionComplete=0,this.go(0));return this.data.images.length},destroy:function(a){Object.each(this.events,function(a,c){"each"in a&&a.each(function(a){document.removeEvent(c,a)})});this.pause(1);["caption","loader","thumbnails"].each(function(a,c){this.options[a]&&(c=this[a].retrieve("timer"))&&clearTimeout(c)},this);"function"==
typeOf(this.el[a])&&this.el[a]();delete this.el.uid},_preload:function(a){a=!1;var b=this.data.images[this._slide].replace(/([^?]+).*/,"$1");if(!(loaded=!!this.cache[b]))this.preloader||(this.preloader=new Asset.image(b,{onerror:function(){},onload:function(){this.store("loaded",!0)}})),loaded=this.preloader.retrieve("loaded")&&this.preloader.get("width");if(loaded&&Date.now()>this.timeToNextTransition&&Date.now()>this.timeToTransitionComplete)if(b=this.data.images[this._slide].replace(/([^?]+).*/,
"$1"),this.preloader&&(this.cache[b]={height:this.preloader.get("height"),src:b,width:this.preloader.get("width")}),this.stopped)this.options.captions&&this.caption.get("morph").cancel().start(this.classes.get("captions","hidden")),this.pause(1),this.end&&this.fireEvent("end"),this.stopped=this.end=!1;else{this.image=this.counter%2?this.b:this.a;"span"==this.image.get("tag")?this.image.setStyles({"background-image":'url("'+this.cache[b].src+'")',display:"block",visibility:"hidden",zIndex:this.counter}):
(this.image.set("styles",{display:"block",height:null,visibility:"hidden",width:null,zIndex:this.counter}),this.image.set(this.cache[b]),this.image.width=this.cache[b].width,this.image.height=this.cache[b].height);this.options.resize&&this._resize(this.image);this.options.center&&this._center(this.image);b=this.image.getParent();this.data.hrefs[this._slide]?(b.set("href",this.data.hrefs[this._slide]),b.set("target",this.data.targets[this._slide])):(b.erase("href"),b.erase("target"));var c=this.data.titles[this._slide];
this.image.set("alt",c);this.options.titles&&b.set("title",c);this.options.loader&&this.loader.fireEvent("hide");this.options.captions&&this.caption.fireEvent("update",a);this.options.thumbnails&&this.thumbnails.fireEvent("update",a);this._show(a);this._loaded(a)}else Date.now()>this.timeToNextTransition&&this.options.loader&&this.loader.fireEvent("show"),this.timer=this._preload.delay(50,this,a)},_show:function(a){if(!this.image.retrieve("morph")){var b=this.options.overlap?{link:"cancel"}:{link:"chain"};
$$(this.a,this.b).set("morph",Object.merge(b,{duration:this.options.duration,onStart:this._start.bind(this),onComplete:this._complete.bind(this),transition:this.options.transition}))}var b=this.classes.get("images","left"==this.direction?"next":"prev"),c=this.classes.get("images","visible"),d=this.counter%2?this.a:this.b;if(a)d.get("morph").cancel().set(b),this.image.get("morph").cancel().set(c);else if(this.options.overlap)d.get("morph").set(c),this.image.get("morph").set(b).start(c);else{a=function(a){this.image.get("morph").start(a)}.pass(c,
this);if(this.firstrun)return a();b=this.classes.get("images","left"==this.direction?"prev":"next");this.image.get("morph").set(b);d.get("morph").set(c).start(b).chain(a)}},_loaded:function(a){this.counter++;this.timeToNextTransition=Date.now()+this.options.duration+this.options.delay;this.direction="left";this.timeToTransitionComplete=a?0:Date.now()+this.options.duration;this._slide==this.data.images.length-1&&(!this.options.loop&&!this.options.random)&&(this.stopped=this.end=!0);if(this.options.random)if(this.showed.i++,
this.showed.i>=this.showed.array.length){a=this._slide;for(this.showed.array.getLast()!=a&&this.showed.array.push(a);this._slide==a;)this.slide=this._slide=Number.random(0,this.data.images.length-1)}else this.slide=this._slide=this.showed.array[this.showed.i];else this.slide=this._slide,this._slide=(this.slide+1)%this.data.images.length;"visible"!=this.image.getStyle("visibility")&&function(){this.image.setStyle("visibility","visible")}.delay(1,this);this.preloader&&(this.preloader=this.preloader.destroy());
this.paused||this._preload()},_center:function(a){var b=a.getSize();a.set("styles",{left:(b.x-this.width)/-2,top:(b.y-this.height)/-2})},_resize:function(a){var b=a.get("height").toFloat(),c=a.get("width").toFloat(),d=this.height/b,f=this.width/c;"fit"==this.options.resize&&(d=f=d>f?f:d);"fill"==this.options.resize&&(d=f=d>f?d:f);a.set("styles",{height:Math.ceil(b*d),width:Math.ceil(c*f)})},_start:function(){this.fireEvent("start")},_complete:function(){this.firstrun&&this.options.paused&&this.pause(1);
this.firstrun=!1;this.fireEvent("complete")}});var p=new Class({Implements:[Chain,Events,Options],options:{delay:0,link:"cancel"},initialize:function(a){if(a){var b=a.options.captions;!0===b&&(b={});this.setOptions(b);b=(b=a.el.getElement(a.classes.get("captions")))?b.dispose().empty():new Element("div",{"class":a.classes.get("captions").substr(1)});a.caption=b;b.set({"aria-busy":!1,"aria-hidden":!1,events:{update:this.update.bind(a)},morph:this.options,role:"description"}).store("delay",this.options.delay);
b.get("id")||b.set("id","Slideshow-"+Date.now());a.el.retrieve("images").set("aria-labelledby",b.get("id"));b.inject(a.el)}},update:function(a){var b=!this.data.captions[this._slide].length,c;(c=this.caption.retrieve("timer"))&&clearTimeout(c);a?(a=b?"hidden":"visible",this.caption.set({"aria-hidden":b,html:this.data.captions[this._slide]}).get("morph").cancel().set(this.classes.get("captions",a))):(b=b?function(){}:function(a){this.caption.store("timer",setTimeout(function(a){this.caption.set("html",
a).morph(this.classes.get("captions","visible"))}.pass(a,this),this.caption.retrieve("delay")))}.pass(this.data.captions[this._slide],this),a=function(){this.caption.set("aria-busy",!1)}.bind(this),this.caption.set("aria-busy",!0).get("morph").cancel().start(this.classes.get("captions","hidden")).chain(b,a))}}),q=new Class({Implements:[Chain,Events,Options],options:{link:"cancel"},initialize:function(a){if(a){var b=a.options.captions;!0===b&&(b={});this.setOptions(b);b=(b=a.el.getElement(a.classes.get("controller")))?
b.dispose().empty():new Element("div",{"class":a.classes.get("controller").substr(1)});a.controller=b;b.set({"aria-hidden":!1,role:"menubar"});var c=(new Element("ul",{role:"menu"})).inject(b),d=0;Object.each(a.accesskeys,function(a,b){var e=(new Element("li",{"class":"pause"==b&&this.options.paused?this.classes.play+" "+this.classes[b]:this.classes[b]})).inject(c),e=this.el.retrieve(b,(new Element("a",{role:"menuitem",tabindex:d++,title:a.label})).inject(e));e.set("events",{click:function(a){this[a]()}.pass(b,
this),mouseenter:function(a){this.addClass(a)}.pass(this.classes.active,e),mouseleave:function(a){this.removeClass(a)}.pass(this.classes.active,e)})},a);b.set({events:{hide:this.hide.pass(a.classes.get("controller","hidden"),b),show:this.show.pass(a.classes.get("controller","visible"),b)},morph:this.options}).store("hidden",!1);a.events.push("keydown",this.keydown.bind(a)).push("keyup",this.keyup.bind(a)).push("mousemove",this.mousemove.bind(a));b.inject(a.el).fireEvent("hide")}},hide:function(a){"false"==
this.get("aria-hidden")&&this.set("aria-hidden",!0).morph(a)},keydown:function(a){Object.each(this.accesskeys,function(b,c){a.key==b.key&&(a.shift==b.shift&&a.control==b.control&&a.alt==b.alt)&&("true"==this.controller.get("aria-hidden")&&this.controller.get("morph").set(this.classes.get("controller","visible")),this.el.retrieve(c).fireEvent("mouseenter"))},this)},keyup:function(a){Object.each(this.accesskeys,function(b,c){a.key==b.key&&(a.shift==b.shift&&a.control==b.control&&a.alt==b.alt)&&("true"==
this.controller.get("aria-hidden")&&this.controller.set("aria-hidden",!1).fireEvent("hide"),this.el.retrieve(c).fireEvent("mouseleave"))},this)},mousemove:function(a){var b=this.el.retrieve("images").getCoordinates();this.controller.fireEvent(a.page.x>b.left&&a.page.x<b.right&&a.page.y>b.top&&a.page.y<b.bottom?"show":"hide")},show:function(a){"true"==this.get("aria-hidden")&&this.set("aria-hidden",!1).morph(a)}}),r=new Class({Implements:[Chain,Events,Options],options:{fps:20,link:"cancel"},initialize:function(a){if(a){var b=
a.options.loader;!0===b&&(b={});this.setOptions(b);var c=(new Element("div",{"aria-hidden":!1,"class":a.classes.get("loader").substr(1),morph:this.options,role:"progressbar"})).store("animate",!1).store("i",0).store("delay",1E3/this.options.fps).inject(a.el);a.loader=c;if(b=c.getStyle("backgroundImage").replace(/url\(['"]?(.*?)['"]?\)/,"$1").trim())b.test(/\.png$/)&&(Browser.ie&&7>Browser.version)&&c.setStyles({backgroundImage:"none",filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+
b+'", sizingMethod="crop")'}),new Asset.image(b,{onload:function(){var a=c.getSize(),b=this.get("width"),g=this.get("height");b>a.x&&c.store("x",a.x).store("animate","x").store("frames",(b/a.x).toInt());g>a.y&&c.store("y",a.y).store("animate","y").store("frames",(g/a.y).toInt())}});c.set("events",{animate:this.animate.bind(c),hide:this.hide.pass(a.classes.get("loader","hidden"),c),show:this.show.pass(a.classes.get("loader","visible"),c)});c.fireEvent("hide")}},animate:function(){var a=this.retrieve("animate");
if(a){var b=(this.retrieve("i").toInt()+1)%this.retrieve("frames");this.store("i",b);b=b*this.retrieve(a)+"px";"x"==a&&this.setStyle("backgroundPosition",b+" 0px");"y"==a&&this.setStyle("backgroundPosition","0px "+b)}},hide:function(a){"false"==this.get("aria-hidden")&&(this.set("aria-hidden",!0).morph(a),this.retrieve("animate")&&clearTimeout(this.retrieve("timer")))},show:function(a){"true"==this.get("aria-hidden")&&(this.set("aria-hidden",!1).morph(a),this.retrieve("animate")&&this.store("timer",
function(){this.fireEvent("animate")}.periodical(this.retrieve("delay"),this)))}}),s=new Class({Implements:[Chain,Events,Options],options:{columns:null,fps:50,link:"cancel",position:null,rows:null,arrows:!0,autohide:!1,scroll:null,speed:100},initialize:function(a){var b=!0===a.options.thumbnails?{}:a.options.thumbnails;this.setOptions(b);var c=a.el.getElement(a.classes.get("thumbnails")),d=c?c.empty():new Element("div",{"class":a.classes.get("thumbnails").substr(1)});a.thumbnails=d;d.set({role:"menubar",
styles:{overflow:"hidden"}});var f=d.retrieve("uid","Slideshow-"+Date.now()),g=(new Element("ul",{role:"menu",styles:{left:0,position:"absolute",top:0},tween:{link:"cancel"}})).inject(d);this.options.arrows&&(d.store("prev",(new Element("div",{"class":a.classes.get("prev").substr(1)})).inject(d)),d.store("next",(new Element("div",{"class":a.classes.get("next").substr(1)})).inject(d)));a.data.thumbnails.each(function(b,c){var d=(new Element("li",{id:f+c})).inject(g),d=(new Element("a",{"class":a.classes.get("thumbnails",
"hidden").substr(1),events:{click:this.click.pass(c,a)},href:a.data.images[c],morph:this.options,role:"menuitem",tabindex:c})).store("uid",c).inject(d);a.options.titles&&d.set("title",a.data.titles[c]);var e=a.data.thumbsizes[c].associate(["width","height"]),e=Object.merge(e,{onload:this.onload.pass(c,a)});(new Asset.image(b,e)).inject(d)},this);d.set("events",{scroll:this.scroll.bind(d),update:this.update.bind(a)});c=d.measure(function(){return this.getCoordinates()});b.scroll||(b.scroll=c.height>
c.width?"y":"x");d.store("props","y"==b.scroll?["top","bottom","height","y","width"]:["left","right","width","x","height"]).store("delay",1E3/this.options.fps);a.events.push("mousemove",this.mousemove.bind(d));d.inject(a.el);if(this.options.autohide){a.el.setStyle("overflow","hidden");var e=this.options.autohide,h={top:"bottom",bottom:"top",left:"right",right:"left"}[e],l={top:"y",bottom:"y",left:"x",right:"x"}[e],n=new Fx.Morph(d,{link:"cancel",duration:500}),k={opacity:1};k[e]=0;k["padding-"+h]=
0;var m={opacity:0};d.addEvents({mouseenter:function(){n.start(k)},mouseleave:function(){var a=d.getSize();m[e]=-a[l];m["padding-"+h]=a[l];n.start(m)}});n.set(m)}},click:function(a){this.go(a);return!1},mousemove:function(a){var b=this.getCoordinates();a.page.x>b.left&&a.page.x<b.right&&a.page.y>b.top&&a.page.y<b.bottom?(this.store("page",a.page),this.retrieve("mouseover")||(this.store("mouseover",!0),this.store("timer",function(){this.fireEvent("scroll")}.periodical(this.retrieve("delay"),this)))):
this.retrieve("mouseover")&&(this.store("mouseover",!1),clearTimeout(this.retrieve("timer")))},onload:function(a){var b=this.thumbnails,c=b.getElements("a")[a];c&&function(b){var c=a==this.slide?"active":"inactive";b.store("loaded",!0).get("morph").set(this.classes.get("thumbnails","hidden")).start(this.classes.get("thumbnails",c))}.delay(Math.max(1E3/this.data.thumbnails.length,100),this,c);if(!b.retrieve("limit")){var d=b.retrieve("props"),c=this.options.thumbnails,f=d[2],g=d[4],d=b.getElement("li:nth-child("+
(a+1)+")").measure(function(){return this.getCoordinates()});if(c.columns||c.rows)b.setStyles({height:this.height,width:this.width}),c.columns.toInt()&&b.setStyle("width",d.width*c.columns.toInt()),c.rows.toInt()&&b.setStyle("height",d.height*c.rows.toInt());var e=b.measure(function(){return this.getCoordinates()});c.position&&(c.position.test(/bottom|top/)&&b.setStyles({bottom:"auto",top:"auto"}).setStyle(c.position,-e.height),c.position.test(/left|right/)&&b.setStyles({left:"auto",right:"auto"}).setStyle(c.position,
-e.width));g=Math.ceil(this.data.images.length/Math.floor(e[g]/d[g]))*d[f];b.getElement("ul").setStyle(f,g).getElements("li").setStyles({height:d.height,width:d.width});b.store("limit",e[f]-g);b.store("speed",0.01*c.speed);b.retrieve("next")&&b.retrieve("next").setStyle("visibility",0>b.retrieve("limit")?"visible":"hidden")}},scroll:function(a,b){var c=this.measure(function(){return this.getCoordinates()}),d=this.getElement("ul").measure(function(){return this.getPosition()}),f=this.retrieve("props"),
g=f[3],e,h=f[0],l=f[2],n=this.getElement("ul").set("tween",{property:h}).get("tween");if(void 0!=a)e=this.retrieve("uid"),e=document.id(e+a).measure(function(){return this.getCoordinates()}),e=c[h]+c[l]/2-e[l]/2-e[h],c=(d[g]-c[h]+e).limit(this.retrieve("limit"),0),n[b?"set":"start"](c),this.retrieve("prev")&&this.retrieve("next")&&(this.retrieve("prev").setStyle("visibility",0>c?"visible":"hidden"),this.retrieve("next").setStyle("visibility",c>this.retrieve("limit")?"visible":"hidden"));else{var f=
c[f[2]]/3,k=this.retrieve("page"),m=-(0.01*this.retrieve("delay")*this.retrieve("speed"));k[g]<c[h]+f?e=(k[g]-c[h]-f)*m:k[g]>c[h]+c[l]-f&&(e=(k[g]-c[h]-c[l]+f)*m);e&&(c=(d[g]-c[h]+e).limit(this.retrieve("limit"),0),n.set(c),this.retrieve("prev")&&this.retrieve("next")&&(this.retrieve("prev").setStyle("visibility",0>c?"visible":"hidden"),this.retrieve("next").setStyle("visibility",c>this.retrieve("limit")?"visible":"hidden")))}},update:function(a){var b=this.thumbnails;b.retrieve("uid");b.getElements("a").each(function(b,
d){if(b.retrieve("loaded"))if(b.retrieve("uid")==this._slide){if(!b.retrieve("active",!1)){b.store("active",!0);var f=this.classes.get("thumbnails","active");a?b.get("morph").set(f):b.morph(f)}}else b.retrieve("active",!0)&&(b.store("active",!1),f=this.classes.get("thumbnails","inactive"),a?b.get("morph").set(f):b.morph(f))},this);b.retrieve("mouseover")||b.fireEvent("scroll",[this._slide,a])}})})();
